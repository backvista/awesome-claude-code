---
name: acc-create-test-builder
description: Генерирует паттерны Test Data Builder и Object Mother для PHP 8.2. Создаёт fluent-билдеры с разумными значениями по умолчанию и фабричные методы для создания тестовых данных.
---

# Генератор Test Data Builder

Генерирует паттерны Test Data Builder и Object Mother для создания тестовых данных.

## Паттерны

### Test Data Builder

Fluent-интерфейс для конструирования тестовых объектов с настраиваемыми свойствами.

**Когда использовать:**
- Сложные объекты с множеством свойств
- Нужно настраивать конкретные свойства для каждого теста
- Хотите чётко выражать намерение теста

### Object Mother

Фабричные методы, возвращающие преднастроенные объекты для типичных сценариев.

**Когда использовать:**
- Стандартные тестовые фикстуры (пользователь по умолчанию, ожидающий заказ)
- Используются во многих тестах
- Именованные сценарии (премиум-клиент, истёкшая подписка)

## Ссылки

- `references/templates.md` — Шаблоны классов Builder и Object Mother
- `references/examples.md` — Полный пример Order с билдерами Value Object и использованием

## Инструкции по генерации

1. **Проанализировать целевой класс:**
   - Параметры конструктора
   - Обязательные vs опциональные свойства
   - Используемые value objects
   - Переходы состояний (для сущностей)

2. **Определить разумные значения по умолчанию:**
   - Генерировать ID автоматически
   - Использовать распространённые/валидные значения
   - Учитывать отношения

3. **Создать Builder с:**
   - Приватным конструктором со значениями по умолчанию
   - Статическим фабричным методом (`aOrder`, `anEmail`)
   - Методами `with*` для каждого свойства
   - Immutable (клонирование в каждом методе)
   - Методом `build()`

4. **Создать Mother с:**
   - Методом `default()`
   - Именованными сценариями (`pending`, `confirmed`, `premium`)
   - Параметризованными методами (`forCustomer`, `withTotal`)

5. **Размещение файлов:**
   - Билдеры: `tests/Builder/{ClassName}Builder.php`
   - Mothers: `tests/Mother/{ClassName}Mother.php`

## Лучшие практики

1. **Разумные значения по умолчанию** — Тесты должны работать без настройки
2. **Fluent-интерфейс** — Цепочка вызовов методов
3. **Immutable билдеры** — Клонирование в каждом методе `with*`
4. **Выразительные имена** — `pending()` а не `withStatus(pending)`
5. **Композиция** — Билдеры могут использовать другие Mothers/Builders
6. **Единая ответственность** — Один билдер на агрегат/сущность
