---
name: acc-find-infinite-loops
description: –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–∏—Å–∫–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –≤ PHP-–∫–æ–¥–µ. –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—è –≤—ã—Ö–æ–¥–∞, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª–∞, –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é —Ä–µ–∫—É—Ä—Å–∏—é, —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏.
---

# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

–ê–Ω–∞–ª–∏–∑ PHP-–∫–æ–¥–∞ –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—è –≤—ã—Ö–æ–¥–∞

```php
// –ë–ê–ì: –ù–µ—Ç —É—Å–ª–æ–≤–∏—è –≤—ã—Ö–æ–¥–∞
while (true) {
    $item = $queue->pop();
    process($item);
    // –ù–µ—Ç break –∫–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
}

// –ë–ê–ì: –£—Å–ª–æ–≤–∏–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
$running = true;
while ($running) {
    doWork();
    // $running –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ false
}

// –ë–ê–ì: Break –≤–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è
while ($items) {
    foreach ($items as $item) {
        if ($item->isDone()) {
            break; // –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ü–∏–∫–ª
        }
    }
}
```

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ü–∏–∫–ª–∞

```php
// –ë–ê–ì: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
for ($i = 0; $i < count($items); $j++) { // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å $i++
    process($items[$i]);
}

// –ë–ê–ì: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
for ($i = 10; $i > 0; $i++) { // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å $i--
    process($i);
}

// –ë–ê–ì: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ü–∏–∫–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
$i = 0;
while ($i < 10) {
    if ($condition) {
        $i = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫
    }
    $i++;
}
```

### 3. –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è

```php
// –ë–ê–ì: –ù–µ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è
function factorial(int $n): int
{
    return $n * factorial($n - 1); // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
}

// –ë–ê–ì: –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º
function traverse(Node $node): void
{
    $this->traverse($node->getNext()); // –ß—Ç–æ –µ—Å–ª–∏ getNext –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç self?
    // –ü—Ä–æ–ø—É—â–µ–Ω–æ: if ($node === null) return;
}

// –ë–ê–ì: –í–∑–∞–∏–º–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è
function a($n) { return b($n); }
function b($n) { return a($n); } // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
```

### 4. –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏

```php
// –ë–ê–ì: –û–±—Ö–æ–¥ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ —Å–≤—è–∑–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
while ($node !== null) {
    $node = $node->next; // –ß—Ç–æ –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π?
}

// –ë–ê–ì: –¶–∏–∫–ª –≤ –≥—Ä–∞—Ñ–µ –æ–±—ä–µ–∫—Ç–æ–≤
function serialize($obj, $visited = []): string
{
    foreach ($obj->getRelations() as $rel) {
        $result .= serialize($rel); // –ú–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ—Å–µ—â–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã
    }
}

// –ò–°–ü–†–ê–í–õ–ï–ù–û:
function serialize($obj, array &$visited = []): string
{
    if (in_array($obj, $visited, true)) {
        return '[circular]';
    }
    $visited[] = $obj;
    // ...
}
```

### 5. –¶–∏–∫–ª—ã —Å–æ–±—ã—Ç–∏–π/—Å–ª—É—à–∞—Ç–µ–ª–µ–π

```php
// –ë–ê–ì: –°–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∞–º–æ —Å–µ–±—è
class UserUpdatedListener
{
    public function handle(UserUpdated $event): void
    {
        $user = $event->getUser();
        $user->touch(); // –ó–∞–ø—É—Å–∫–∞–µ—Ç –µ—â–µ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ UserUpdated
    }
}

// –ë–ê–ì: –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å
public function handle(Message $message): void
{
    try {
        $this->process($message);
    } catch (Exception $e) {
        $this->queue->publish($message); // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    }
}
```

### 6. –ü–æ–≤—Ç–æ—Ä—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```php
// –ë–ê–ì: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã
function fetch(string $url): string
{
    while (true) {
        try {
            return $this->httpClient->get($url);
        } catch (Exception $e) {
            sleep(1);
            // –ù–µ—Ç max retries, –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –æ—à–∏–±–∫–µ
        }
    }
}

// –ò–°–ü–†–ê–í–õ–ï–ù–û:
function fetch(string $url, int $maxRetries = 3): string
{
    $attempts = 0;
    while ($attempts < $maxRetries) {
        try {
            return $this->httpClient->get($url);
        } catch (Exception $e) {
            $attempts++;
            if ($attempts >= $maxRetries) {
                throw $e;
            }
            sleep(1);
        }
    }
}
```

### 7. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π yield –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

```php
// –ë–ê–ì: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
function allNumbers(): Generator
{
    $i = 0;
    while (true) {
        yield $i++;
        // –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–π –∫–æ–¥ –º–æ–∂–µ—Ç –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–ê–ì:
foreach (allNumbers() as $n) {
    echo $n; // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
}
```

### 8. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ë–î –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```php
// –ë–ê–ì: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
$offset = 0;
while (true) {
    $batch = $repository->findBy([], null, 100, $offset);
    if (empty($batch)) {
        break;
    }
    process($batch);
    // –ü—Ä–æ–ø—É—â–µ–Ω–æ: $offset += 100;
}
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã Grep

```bash
# while(true) –±–µ–∑ break
Grep: "while\s*\(\s*true\s*\)" --glob "**/*.php"

# –†–µ–∫—É—Ä—Å–∏—è
Grep: "function\s+(\w+)\([^)]*\)[^{]*\{[^}]*\1\s*\(" --glob "**/*.php"

# for —Ü–∏–∫–ª —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º
Grep: "for\s*\([^;]+;\s*\$\w+\s*[<>]\s*[^;]+;\s*\$(?!\1)" --glob "**/*.php"

# while –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
Grep: "while\s*\(\s*\$\w+\s*\)" --glob "**/*.php"
```

## –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏

| –ü–∞—Ç—Ç–µ—Ä–Ω | –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å |
|---------|----------|
| –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π —Ä–µ–∫—É—Ä—Å–∏–∏ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ü–∏–∫–ª–∞ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –û–±—Ö–æ–¥ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ | üü† –í–∞–∂–Ω–æ |
| –°–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∞–º–æ —Å–µ–±—è | üü† –í–∞–∂–Ω–æ |
| while(true) –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ | üü† –í–∞–∂–Ω–æ |

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è

### –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```php
const MAX_ITERATIONS = 1000;

$iterations = 0;
while ($condition && $iterations < self::MAX_ITERATIONS) {
    // ...
    $iterations++;
}

if ($iterations >= self::MAX_ITERATIONS) {
    throw new RuntimeException('Max iterations exceeded');
}
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–µ—â–µ–Ω–Ω—ã—Ö —É–∑–ª–æ–≤

```php
function traverse($node, array &$visited = []): void
{
    $id = spl_object_id($node);
    if (isset($visited[$id])) {
        return;
    }
    $visited[$id] = true;
    // ...
}
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã —Ä–µ–∫—É—Ä—Å–∏–∏

```php
function process($data, int $depth = 0): mixed
{
    if ($depth > 100) {
        throw new RuntimeException('Max recursion depth');
    }
    return process($child, $depth + 1);
}
```

## –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

```markdown
### –†–∏—Å–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: [–û–ø–∏—Å–∞–Ω–∏–µ]

**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üî¥/üü†/üü°
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `file.php:line`
**–¢–∏–ø:** [Missing Break|Wrong Variable|Unbounded Recursion|...]

**–ü—Ä–æ–±–ª–µ–º–∞:**
[–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∫ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª]

**–ö–æ–¥:**
```php
// –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```php
// –° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
```

**–£—Å–ª–æ–≤–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞:**
[–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —ç—Ç–æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª]
```
